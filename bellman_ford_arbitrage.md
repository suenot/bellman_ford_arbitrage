# Алгоритм Беллмана-Форда для поиска криптовалютного арбитража

## Что такое арбитраж?

Арбитраж - это торговая стратегия, которая использует разницу в ценах на одни и те же активы на разных рынках. В контексте криптовалют, это может быть ситуация, когда можно купить криптовалюту на одной бирже дешевле и продать на другой дороже, получив прибыль.

## Почему используется алгоритм Беллмана-Форда?

Алгоритм Беллмана-Форда идеально подходит для поиска арбитражных возможностей по следующим причинам:
1. Он может работать с отрицательными весами рёбер (что соответствует возможности получения прибыли)
2. Он способен находить отрицательные циклы (что соответствует арбитражным возможностям)

## Как работает код?

### 1. Инициализация

```python
def __init__(self, trading_fee: float = 0.001):
    self.graph = nx.DiGraph()
    self.trading_fee = trading_fee
```

Класс `BellmanFordArbitrage` инициализируется с:
- Направленным графом (DiGraph) из библиотеки NetworkX
- Торговой комиссией (по умолчанию 0.1%)

### 2. Создание графа

```python
def create_graph(self, exchange_rates: Dict[Tuple[str, str], float]):
```

Этот метод принимает словарь обменных курсов, где:
- Ключ - это кортеж (валюта_from, валюта_to)
- Значение - это обменный курс

Важные моменты:
- Применяется торговая комиссия к каждому курсу
- Веса рёбер графа = -log(курс)
- Использование логарифма превращает умножение курсов в сложение весов

### 3. Поиск арбитража

```python
def find_arbitrage(self, start_currency: str)
```

Этот метод реализует сам алгоритм Беллмана-Форда:

1. Инициализация расстояний:
   - Для стартовой валюты = 0
   - Для остальных валют = бесконечность

2. Релаксация рёбер:
   - Выполняется (V-1) раз, где V - количество вершин
   - Для каждого ребра проверяется возможность уменьшить расстояние

3. Проверка на отрицательный цикл:
   - Если после (V-1) итераций всё ещё можно уменьшить какое-то расстояние
   - Значит найден отрицательный цикл (арбитражная возможность)

4. Восстановление пути:
   - Если найден цикл, восстанавливается последовательность валют
   - Вычисляется итоговый коэффициент прибыли

## Пример использования

```python
# Создаём экземпляр класса с комиссией 0.1%
arbitrage_finder = BellmanFordArbitrage(trading_fee=0.001)

# Определяем обменные курсы
exchange_rates = {
    ('USD', 'EUR'): 0.85,
    ('EUR', 'GBP'): 0.87,
    ('GBP', 'USD'): 1.42
}

# Создаём граф
arbitrage_finder.create_graph(exchange_rates)

# Ищем арбитражные возможности начиная с USD
has_arbitrage, path, profit = arbitrage_finder.find_arbitrage('USD')

if has_arbitrage:
    print(f"Найден арбитраж! Путь: {' -> '.join(path)}")
    print(f"Коэффициент прибыли: {profit:.4f}")
else:
    print("Арбитражных возможностей не найдено")
```

## Важные замечания

1. Комиссии играют критическую роль - без их учёта вы можете найти "фантомные" возможности, которые на практике не принесут прибыль

2. Алгоритм находит только первый встреченный арбитражный цикл, хотя их может быть несколько

3. В реальном мире нужно учитывать:
   - Задержки при выполнении транзакций
   - Проскальзывание цен
   - Ликвидность на каждой бирже
   - Возможные ограничения на вывод средств

## Оптимизации и улучшения

1. Можно добавить проверку минимальной прибыли, чтобы искать только значимые арбитражные возможности

2. Реализовать поиск всех возможных арбитражных циклов, а не только первого найденного

3. Добавить учёт объёма доступной ликвидности для каждого обменного курса

4. Реализовать асинхронное получение актуальных курсов с бирж
